# 数据库备份工具

一个功能完整的MySQL数据库备份工具，支持图形界面操作，提供安全的密码存储和自动化备份功能。

## 功能特性

### 1. 数据库连接
- 支持连接本地MySQL数据库（默认端口3306）
- 支持自定义主机地址和端口
- 实时连接测试功能
- 自动获取可用数据库列表

### 2. 备份功能
- **mysqldump方式**：优先使用mysqldump命令进行备份（推荐，效率高）
- **Python方式**：当mysqldump不可用时，使用Python代码备份
- 支持选择备份内容：
  - 包含表结构
  - 包含数据
  - 压缩备份文件（节省存储空间）

### 3. 记忆功能
- **自动记忆数据库连接信息**：主机、端口、用户名
- **安全密码存储**：使用AES加密存储密码
- **记忆备份路径**：自动记录上次使用的备份目录
- **配置持久化**：所有设置保存在JSON配置文件中

### 4. 界面特性
- 现代化图形用户界面（基于tkinter）
- 实时操作日志显示
- 备份进度条指示
- 状态信息实时更新
- 友好的错误提示

## 安装步骤

### 1. 环境要求
- Python 3.6+
- MySQL数据库
- tkinter（通常随Python安装）

### 2. 安装依赖包
```bash
pip install -r requirements.txt
```

或者手动安装：
```bash
pip install pymysql cryptography
```

### 3. 运行程序
```bash
python database_backup.py
```

## 使用方法

### 1. 首次使用
1. 运行程序后，在"数据库连接配置"区域填写：
   - 主机地址（默认：localhost）
   - 端口（默认：3306）
   - 用户名（具有备份权限的MySQL用户）
   - 密码

2. 点击"测试连接"按钮验证连接是否成功

### 2. 选择数据库
1. 连接成功后，在"数据库选择"区域会自动显示可用数据库
2. 从下拉列表中选择要备份的数据库
3. 如需刷新数据库列表，点击"刷新"按钮

### 3. 配置备份路径
1. 在"备份路径配置"区域设置备份文件的保存位置
2. 可以手动输入路径或点击"浏览"按钮选择文件夹

### 4. 选择备份选项
- **包含表结构**：导出数据库表结构（CREATE TABLE语句）
- **包含数据**：导出表中的实际数据（INSERT语句）
- **压缩备份文件**：自动压缩备份文件为.gz格式

### 5. 开始备份
1. 点击"开始备份"按钮
2. 观察进度条和日志信息
3. 备份完成后会显示成功消息

### 6. 保存配置
- 点击"保存配置"保存当前所有设置
- 下次启动时会自动加载之前保存的配置

## 备份文件说明

### 文件命名格式
```
{数据库名}_{年月日}_{时分秒}.sql[.gz]
```

例如：`mydb_20251029_151123.sql` 或 `mydb_20251029_151123.sql.gz`

### 文件格式
- **未压缩**：`*.sql` - 纯文本SQL文件
- **压缩**：`*.sql.gz` - 压缩的SQL文件

### 恢复备份
```bash
# 解压缩（如果文件是压缩格式）
gunzip backup_file.sql.gz

# 恢复数据库
mysql -h localhost -u username -p database_name < backup_file.sql
```

## 安全特性

### 密码加密
- 使用Fernet（基于AES 128）对称加密
- 加密密钥存储在`.backup_key`文件中
- 密码不会以明文形式保存在配置文件中

### 配置文件权限
- 配置文件`backup_config.json`包含敏感信息
- 建议在生产环境中设置适当的文件权限
- 可以使用"重置配置"功能清除所有敏感信息

## 故障排除

### 常见问题

#### 1. 连接失败
- **检查MySQL服务是否运行**
- **确认端口号正确**（默认3306）
- **验证用户名和密码**
- **检查防火墙设置**

#### 2. 权限错误
- **确保MySQL用户具有备份权限**
- **授予必要权限**：
```sql
GRANT SELECT, SHOW VIEW, TRIGGER ON *.* TO 'username'@'localhost';
FLUSH PRIVILEGES;
```

#### 3. mysqldump命令未找到
- 程序会自动降级到Python备份方式
- 确保安装了MySQL客户端工具
- 将mysqldump添加到系统PATH环境变量

#### 4. 备份文件过大
- 启用"压缩备份文件"选项
- 只选择需要的表进行备份
- 定期清理旧的备份文件

### 性能优化
- 对于大型数据库，优先使用mysqldump方式
- 在数据库使用较少的时间段进行备份
- 考虑使用增量备份策略

## 技术细节

### 备份方式对比

| 方式 | 优点 | 缺点 | 适用场景 |
|------|------|------|----------|
| mysqldump | 速度快，支持所有MySQL特性 | 需要安装MySQL客户端 | 大型数据库生产环境 |
| Python | 纯Python实现，跨平台 | 速度相对较慢 | 开发环境或客户端工具缺失 |

### 配置文件格式
```json
{
  "host": "localhost",
  "port": "3306",
  "username": "your_username",
  "encrypted_password": "encrypted_password_here",
  "backup_path": "/path/to/backup/directory"
}
```

## 更新日志

### v1.0.0 (2025-10-29)
- 初始版本发布
- 实现基础数据库备份功能
- 添加图形用户界面
- 实现配置记忆和密码加密
- 支持双重备份方式（mysqldump + Python）

## 许可证

本项目采用MIT许可证，详情请查看LICENSE文件。

## 贡献

欢迎提交Issue和Pull Request来改进这个工具。

## 支持

如有问题或建议，请通过以下方式联系：
- 提交GitHub Issue
- 发送邮件至项目维护者

---

**免责声明**：使用本工具进行数据库备份前，请务必在测试环境中验证功能的正确性。建议定期测试备份文件的恢复功能，确保数据安全。
